schema: '2.0'
stages:
  data_preprocessing_for_volume_anomaly:
    cmd: poetry run python $(dvc root)/src/features/preprocessing_for_volume_anomaly.py
      --config=$(dvc root)/params.yaml --config=params.yaml
    deps:
    - path: data/raw/BTCUSD_1_min_aver-src_cb_disk_.feather
      md5: fa02dca689153bbffd3da357edb2af00
      size: 133339034
    - path: src/features/preprocessing_for_volume_anomaly.py
      md5: 0b7da2118b3cdb8789f2f523b36e8f58
      size: 1761
    params:
      params.yaml:
        base:
          log_level: INFO
          project_path: ${PATH_TO_TEST_MIDAS}
        data:
          raw: ${PATH_TO_TEST_MIDAS}/data/raw/BTCUSD_1_min_aver-src_cb_disk_.feather
          processed_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/processed/processed_volume_anomaly.feather
          processed_trend_detection: ${PATH_TO_TEST_MIDAS}/data/processed/processed_trend_detection.feather
          result_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_volume_anomaly.feather
          result_trend_detection: ${PATH_TO_TEST_MIDAS}/data/result/result_trend_detection.feather
          result_with_trend_and_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_with_trend_and_anomaly.feather
        featurize:
          volume_anomaly:
            gap_end_date: 28800
            step_to_end_date: 1200
            thresholds:
            - 0.8
            - 0.7
            - 0.5
            - 0.3
            laps:
            - 3
            - 6
            - 9
            mean_indicator: 600
            threshold_indicator: 0.1
            columns_rolling_mean:
            - 3600
            - 5400
            - 7200
            column_with_anomaly: volume_anomaly
          trend_detection:
            decay_sm: 720
            decay_lm: 1560
            decay_signal: 9
            period_signal: 9
            column_for_macd: close
            order_for_fall_rise: 1000
            order_for_flat: 5
            window_size_for_rolling_mean: 150
            left_border_for_flat_detection: -0.0007
            right_border_for_flat_detection: 0.0007
            column_with_trend: trend
    outs:
    - path: data/processed/processed_volume_anomaly.feather
      md5: 3b8537e86bca7b2730de70f4980d4274
      size: 282556098
  find_volume_anomaly:
    cmd: poetry run python $(dvc root)/src/models/volume_anomaly.py --config=$(dvc
      root)/params.yaml --config=params.yaml
    deps:
    - path: data/processed/processed_volume_anomaly.feather
      md5: 3b8537e86bca7b2730de70f4980d4274
      size: 282556098
    - path: src/models/volume_anomaly.py
      md5: c5372817c4e94304c53945e038ae8d1a
      size: 6510
    params:
      params.yaml:
        base:
          log_level: INFO
          project_path: ${PATH_TO_TEST_MIDAS}
        data:
          raw: ${PATH_TO_TEST_MIDAS}/data/raw/BTCUSD_1_min_aver-src_cb_disk_.feather
          processed_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/processed/processed_volume_anomaly.feather
          processed_trend_detection: ${PATH_TO_TEST_MIDAS}/data/processed/processed_trend_detection.feather
          result_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_volume_anomaly.feather
          result_trend_detection: ${PATH_TO_TEST_MIDAS}/data/result/result_trend_detection.feather
          result_with_trend_and_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_with_trend_and_anomaly.feather
        featurize:
          volume_anomaly:
            gap_end_date: 28800
            step_to_end_date: 1200
            thresholds:
            - 0.8
            - 0.7
            - 0.5
            - 0.3
            laps:
            - 3
            - 6
            - 9
            mean_indicator: 600
            threshold_indicator: 0.1
            columns_rolling_mean:
            - 3600
            - 5400
            - 7200
            column_with_anomaly: volume_anomaly
          trend_detection:
            decay_sm: 720
            decay_lm: 1560
            decay_signal: 9
            period_signal: 9
            column_for_macd: close
            order_for_fall_rise: 1000
            order_for_flat: 5
            window_size_for_rolling_mean: 150
            left_border_for_flat_detection: -0.0007
            right_border_for_flat_detection: 0.0007
            column_with_trend: trend
    outs:
    - path: data/result/result_volume_anomaly.feather
      md5: 957e293cbf39c7e04ba98e49fb3de596
      size: 133346778
  preprocessing_for_trend_detection:
    cmd: poetry run python $(dvc root)/src/features/preprocessing_for_trend_detection.py
      --config=$(dvc root)/params.yaml --config=params.yaml
    deps:
    - path: data/raw/BTCUSD_1_min_aver-src_cb_disk_.feather
      md5: fa02dca689153bbffd3da357edb2af00
      size: 133339034
    - path: src/features/preprocessing_for_trend_detection.py
      md5: 31631ed5c1d37e0765a7003da549a28a
      size: 2594
    params:
      params.yaml:
        base:
          log_level: INFO
          project_path: ${PATH_TO_TEST_MIDAS}
        data:
          raw: ${PATH_TO_TEST_MIDAS}/data/raw/BTCUSD_1_min_aver-src_cb_disk_.feather
          processed_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/processed/processed_volume_anomaly.feather
          processed_trend_detection: ${PATH_TO_TEST_MIDAS}/data/processed/processed_trend_detection.feather
          result_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_volume_anomaly.feather
          result_trend_detection: ${PATH_TO_TEST_MIDAS}/data/result/result_trend_detection.feather
          result_with_trend_and_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_with_trend_and_anomaly.feather
        featurize:
          volume_anomaly:
            gap_end_date: 28800
            step_to_end_date: 1200
            thresholds:
            - 0.8
            - 0.7
            - 0.5
            - 0.3
            laps:
            - 3
            - 6
            - 9
            mean_indicator: 600
            threshold_indicator: 0.1
            columns_rolling_mean:
            - 3600
            - 5400
            - 7200
            column_with_anomaly: volume_anomaly
          trend_detection:
            decay_sm: 720
            decay_lm: 1560
            decay_signal: 9
            period_signal: 9
            column_for_macd: close
            order_for_fall_rise: 1000
            order_for_flat: 5
            window_size_for_rolling_mean: 150
            left_border_for_flat_detection: -0.0007
            right_border_for_flat_detection: 0.0007
            column_with_trend: trend
    outs:
    - path: data/processed/processed_trend_detection.feather
      md5: 36ab68956a05e27bc01389f7cd74b236
      size: 193056434
  trend_detection:
    cmd: poetry run python $(dvc root)/src/models/trend_detection.py --config=$(dvc
      root)/params.yaml --config=params.yaml
    deps:
    - path: data/processed/processed_trend_detection.feather
      md5: 36ab68956a05e27bc01389f7cd74b236
      size: 193056434
    - path: src/models/trend_detection.py
      md5: 8de3da5d9b73630b6319b1f415b2f1a7
      size: 6995
    params:
      params.yaml:
        base:
          log_level: INFO
          project_path: ${PATH_TO_TEST_MIDAS}
        data:
          raw: ${PATH_TO_TEST_MIDAS}/data/raw/BTCUSD_1_min_aver-src_cb_disk_.feather
          processed_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/processed/processed_volume_anomaly.feather
          processed_trend_detection: ${PATH_TO_TEST_MIDAS}/data/processed/processed_trend_detection.feather
          result_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_volume_anomaly.feather
          result_trend_detection: ${PATH_TO_TEST_MIDAS}/data/result/result_trend_detection.feather
          result_with_trend_and_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_with_trend_and_anomaly.feather
        featurize:
          volume_anomaly:
            gap_end_date: 28800
            step_to_end_date: 1200
            thresholds:
            - 0.8
            - 0.7
            - 0.5
            - 0.3
            laps:
            - 3
            - 6
            - 9
            mean_indicator: 600
            threshold_indicator: 0.1
            columns_rolling_mean:
            - 3600
            - 5400
            - 7200
            column_with_anomaly: volume_anomaly
          trend_detection:
            decay_sm: 720
            decay_lm: 1560
            decay_signal: 9
            period_signal: 9
            column_for_macd: close
            order_for_fall_rise: 1000
            order_for_flat: 5
            window_size_for_rolling_mean: 150
            left_border_for_flat_detection: -0.0007
            right_border_for_flat_detection: 0.0007
            column_with_trend: trend
    outs:
    - path: data/result/result_trend_detection.feather
      md5: a69ea01d325c1db150f5928af91b2b96
      size: 148352106
  concat:
    cmd: poetry run python $(dvc root)/src/models/concat.py --config=$(dvc root)/params.yaml
    deps:
    - path: data/result/result_trend_detection.feather
      md5: a69ea01d325c1db150f5928af91b2b96
      size: 148352106
    - path: data/result/result_volume_anomaly.feather
      md5: 957e293cbf39c7e04ba98e49fb3de596
      size: 133346778
    - path: src/models/concat.py
      md5: 20d08b70669e59cac6e21132046ebae6
      size: 1743
    params:
      params.yaml:
        base:
          log_level: INFO
          project_path: ${PATH_TO_TEST_MIDAS}
        data:
          raw: ${PATH_TO_TEST_MIDAS}/data/raw/BTCUSD_1_min_aver-src_cb_disk_.feather
          processed_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/processed/processed_volume_anomaly.feather
          processed_trend_detection: ${PATH_TO_TEST_MIDAS}/data/processed/processed_trend_detection.feather
          result_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_volume_anomaly.feather
          result_trend_detection: ${PATH_TO_TEST_MIDAS}/data/result/result_trend_detection.feather
          result_with_trend_and_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_with_trend_and_anomaly.feather
        featurize:
          volume_anomaly:
            gap_end_date: 28800
            step_to_end_date: 1200
            thresholds:
            - 0.8
            - 0.7
            - 0.5
            - 0.3
            laps:
            - 3
            - 6
            - 9
            mean_indicator: 600
            threshold_indicator: 0.1
            columns_rolling_mean:
            - 3600
            - 5400
            - 7200
            column_with_anomaly: volume_anomaly
          trend_detection:
            decay_sm: 720
            decay_lm: 1560
            decay_signal: 9
            period_signal: 9
            column_for_macd: close
            order_for_fall_rise: 1000
            order_for_flat: 5
            window_size_for_rolling_mean: 150
            left_border_for_flat_detection: -0.0007
            right_border_for_flat_detection: 0.0007
            column_with_trend: trend
    outs:
    - path: data/result/result_with_trend_and_anomaly.feather
      md5: 5e721e961bdb98df71cb6a30e6dd69aa
      size: 148359834
  plots_for_trend:
    cmd: poetry run python ./src/visualization/plots_for_trend.py --config=./params.yaml
      --config=params.yaml
    deps:
    - path: data/result/result_with_trend_and_anomaly.feather
      md5: 5e721e961bdb98df71cb6a30e6dd69aa
      size: 148359834
    - path: src/visualization/plots_for_trend.py
      md5: d4657b375de5e4fb914b4a099da53f61
      size: 2802
    params:
      params.yaml:
        base:
          log_level: INFO
          project_path: ${PATH_TO_TEST_MIDAS}
        data:
          raw: ${PATH_TO_TEST_MIDAS}/data/raw/BTCUSD_1_min_aver-src_cb_disk_.feather
          processed_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/processed/processed_volume_anomaly.feather
          processed_trend_detection: ${PATH_TO_TEST_MIDAS}/data/processed/processed_trend_detection.feather
          result_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_volume_anomaly.feather
          result_trend_detection: ${PATH_TO_TEST_MIDAS}/data/result/result_trend_detection.feather
          result_with_trend_and_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_with_trend_and_anomaly.feather
        featurize:
          volume_anomaly:
            gap_end_date: 28800
            step_to_end_date: 1200
            thresholds:
            - 0.8
            - 0.7
            - 0.5
            - 0.3
            laps:
            - 3
            - 6
            - 9
            mean_indicator: 600
            threshold_indicator: 0.1
            columns_rolling_mean:
            - 3600
            - 5400
            - 7200
            column_with_anomaly: volume_anomaly
          trend_detection:
            decay_sm: 720
            decay_lm: 1560
            decay_signal: 9
            period_signal: 9
            column_for_macd: close
            order_for_fall_rise: 1000
            order_for_flat: 5
            window_size_for_rolling_mean: 150
            left_border_for_flat_detection: -0.0007
            right_border_for_flat_detection: 0.0007
            column_with_trend: trend
            step: 14
        reports:
          path_to_trend_png: ${PATH_TO_TEST_MIDAS}/reports/trends/
  plots_for_volume:
    cmd: poetry run python $(dvc root)/src/visualization/plots_for_volume.py --config=$(dvc
      root)/params.yaml --config=params.yaml
    deps:
    - path: data/result/result_with_trend_and_anomaly.feather
      md5: 5e721e961bdb98df71cb6a30e6dd69aa
      size: 148359834
    - path: src/visualization/plots_for_volume.py
      md5: f6871b28478c2971f5fcd816ee6d10a3
      size: 2234
    params:
      params.yaml:
        base:
          log_level: INFO
          project_path: ${PATH_TO_TEST_MIDAS}
        data:
          raw: ${PATH_TO_TEST_MIDAS}/data/raw/BTCUSD_1_min_aver-src_cb_disk_.feather
          processed_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/processed/processed_volume_anomaly.feather
          processed_trend_detection: ${PATH_TO_TEST_MIDAS}/data/processed/processed_trend_detection.feather
          result_volume_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_volume_anomaly.feather
          result_trend_detection: ${PATH_TO_TEST_MIDAS}/data/result/result_trend_detection.feather
          result_with_trend_and_anomaly: ${PATH_TO_TEST_MIDAS}/data/result/result_with_trend_and_anomaly.feather
        featurize:
          volume_anomaly:
            gap_end_date: 28800
            step_to_end_date: 1200
            thresholds:
            - 0.8
            - 0.7
            - 0.5
            - 0.3
            laps:
            - 3
            - 6
            - 9
            mean_indicator: 600
            threshold_indicator: 0.1
            columns_rolling_mean:
            - 3600
            - 5400
            - 7200
            column_with_anomaly: volume_anomaly
          trend_detection:
            decay_sm: 720
            decay_lm: 1560
            decay_signal: 9
            period_signal: 9
            column_for_macd: close
            order_for_fall_rise: 1000
            order_for_flat: 5
            window_size_for_rolling_mean: 150
            left_border_for_flat_detection: -0.0007
            right_border_for_flat_detection: 0.0007
            column_with_trend: trend
        reports:
          trend_detection:
            step: 14
            path_to_trend_png: ${PATH_TO_TEST_MIDAS}/reports/trends/
            colors:
            - r
            - g
            - b
          volume_anomaly:
            path_to_volume_png: ${PATH_TO_TEST_MIDAS}/reports/volumes/
            step: 17
            width_of_bar: 0.00067
            colors:
            - r
            - b
